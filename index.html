<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Logic Master Pro - Official Logic</title>
    <style>
        :root {
            --primary: #2ecc71;
            --info: #3498db;
            --dark: #2c3e50;
            --danger: #e74c3c;
            --bg: #f4f7f6;
            --gold: #f1c40f;
        }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: var(--bg); padding: 20px; display: flex; justify-content: center; }
        .container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); width: 100%; max-width: 700px; }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .tab-btn { padding: 10px 20px; border: none; background: none; cursor: pointer; font-weight: bold; color: #7f8c8d; transition: 0.3s; }
        .tab-btn.active { color: var(--info); border-bottom: 3px solid var(--info); }

        .section { padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #eee; display: none; }
        .section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .encode-bg { background-color: #f0fff4; border-color: #c6f6d5; }
        .decode-bg { background-color: #f0f7ff; border-color: #bee3f8; }

        label { display: block; margin-bottom: 10px; font-weight: bold; color: #4a5568; }
        input { width: 100%; padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1.3em; text-align: center; box-sizing: border-box; }
        input:focus { border-color: var(--info); outline: none; }
        input.invalid { border-color: var(--danger); background-color: #fff5f5; }

        .status-msg { font-size: 0.85em; min-height: 1.5em; margin-top: 5px; font-weight: 500; }
        .error { color: var(--danger); }
        .success { color: var(--primary); }

        button { padding: 15px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; color: white; width: 100%; font-size: 1.1em; margin-top: 10px; transition: 0.2s; }
        button:disabled { background-color: #cbd5e0; cursor: not-allowed; }
        .btn-encode { background-color: var(--primary); }
        .btn-decode { background-color: var(--info); }

        .result-display { margin-top: 20px; text-align: center; font-size: 2em; font-weight: bold; color: var(--dark); border-top: 2px dashed #eee; padding-top: 15px; letter-spacing: 2px; }

        .explainer { background: var(--dark); color: #ecf0f1; padding: 25px; border-radius: 15px; margin-top: 30px; }
        .explainer h3 { color: var(--gold); margin-top: 0; border-bottom: 1px solid #455a64; padding-bottom: 10px; }
        .formula-box { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.9em; color: var(--gold); margin: 10px 0; }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('encode')">‡∏™‡∏£‡πâ‡∏≤‡∏á QR</button>
        <button class="tab-btn" onclick="switchTab('decode')">‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™‡∏´‡∏≤‡∏ï‡πâ‡∏ô‡∏Ç‡∏±‡πâ‡∏ß</button>
    </div>

    <div id="encode" class="section encode-bg active">
        <label>‡πÄ‡∏•‡∏Ç‡∏ï‡πâ‡∏ô‡∏Ç‡∏±‡πâ‡∏ß ‚Æï ‡∏£‡∏´‡∏±‡∏™ QR (‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö 8 ‡∏´‡∏•‡∏±‡∏Å)</label>
        <input type="text" id="serialIn" placeholder="‡πÄ‡∏ä‡πà‡∏ô 01735041" maxlength="8" oninput="validate(this, 8, 'sMsg', 'btnE', true)">
        <div id="sMsg" class="status-msg"></div>
        <button id="btnE" class="btn-encode" onclick="doEncode()" disabled>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™ QR</button>
        <div id="resE" class="result-display"></div>
    </div>

    <div id="decode" class="section decode-bg">
        <label>‡∏£‡∏´‡∏±‡∏™ QR ‚Æï ‡πÄ‡∏•‡∏Ç‡∏ï‡πâ‡∏ô‡∏Ç‡∏±‡πâ‡∏ß (‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö 5 ‡∏´‡∏•‡∏±‡∏Å)</label>
        <input type="text" id="qrIn" placeholder="‡πÄ‡∏ä‡πà‡∏ô I4SR8" maxlength="5" oninput="validate(this, 5, 'qMsg', 'btnD', false)">
        <div id="qMsg" class="status-msg"></div>
        <button id="btnD" class="btn-decode" onclick="doDecode()" disabled>‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™‡∏´‡∏≤‡∏ï‡πâ‡∏ô‡∏Ç‡∏±‡πâ‡∏ß</button>
        <div id="resD" class="result-display" style="color: var(--info);"></div>
    </div>

    <div class="explainer">
        <h3>üí° ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (Dynamic Offset Logic)</h3>
        <p style="font-size: 0.85em;">‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á‡∏õ‡∏Å‡∏ï‡∏¥ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ñ‡πà‡∏≤ Offset (K) ‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà 2 ‡∏Ç‡∏≠‡∏á‡∏£‡∏´‡∏±‡∏™ QR ‡∏Ñ‡∏£‡∏±‡∏ö</p>
        <div class="formula-box">
            K = (32,216,237 √ó IndexOf(QR[1]) + 42,413,113) mod 100,000,000
        </div>
        <p style="font-size: 0.85em;"><b>‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™:</b> ‡∏ô‡∏≥‡∏Ñ‡πà‡∏≤‡∏ê‡∏≤‡∏ô 10 ‡∏Ç‡∏≠‡∏á QR ‡∏°‡∏≤‡∏ö‡∏ß‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏≤ K ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏≤‡πÄ‡∏®‡∏©‡∏à‡∏≤‡∏Å 100 ‡∏•‡πâ‡∏≤‡∏ô ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç‡∏ï‡πâ‡∏ô‡∏Ç‡∏±‡πâ‡∏ß‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏°‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö</p>
        <div class="formula-box">
            Serial = (Value(QR) + K) mod 100,000,000
        </div>
    </div>
</div>

<script>
    const BASE36 = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const MOD_SERIAL = 100000000n;
    const K_MULTIPLIER = 32216237n;
    const K_OFFSET = 42413113n;
    const MAX_N = 60466176n; // 36^5

    function getK(charIndex) {
        return (K_MULTIPLIER * BigInt(charIndex) + K_OFFSET) % MOD_SERIAL;
    }

    function switchTab(type) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(type).classList.add('active');
        event.target.classList.add('active');
    }

    function validate(el, len, msgId, btnId, isNum) {
        let val = el.value;
        const btn = document.getElementById(btnId);
        const msg = document.getElementById(msgId);
        el.value = isNum ? val.replace(/\D/g, '') : val.replace(/[^a-zA-Z0-9]/g, '').toUpperCase();
        
        if (el.value.length === len) {
            msg.innerText = "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‚úì";
            msg.className = "status-msg success";
            el.classList.remove('invalid');
            btn.disabled = false;
        } else {
            msg.innerText = el.value.length > 0 ? `‚ö†Ô∏è ‡∏Ç‡∏≤‡∏î‡∏≠‡∏µ‡∏Å ${len - el.value.length} ‡∏´‡∏•‡∏±‡∏Å` : "";
            msg.className = "status-msg error";
            el.classList.add('invalid');
            btn.disabled = true;
        }
    }

    function toBase36(value, length) {
        let result = '';
        let v = BigInt(value);
        for (let i = 0; i < length; i++) {
            result = BASE36[Number(v % 36n)] + result;
            v = v / 36n;
        }
        return result;
    }

    function doEncode() {
        const s = BigInt(document.getElementById('serialIn').value);
        let found = false;
        
        // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ QR ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° (Logic ‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏á‡∏°‡∏≤)
        for (let mult = 0n; mult < 3n; mult++) {
            const x = s + mult * MOD_SERIAL;
            for (let i = 0; i < 36; i++) {
                const k = getK(i);
                const n = x - k;
                if (n >= 0n && n < MAX_N) {
                    const qr = toBase36(n, 5);
                    if (BASE36.indexOf(qr[1]) === i) {
                        document.getElementById('resE').innerText = qr;
                        found = true;
                        break;
                    }
                }
            }
            if (found) break;
        }
        if (!found) document.getElementById('resE').innerText = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏î‡πâ";
    }

    function doDecode() {
        const qr = document.getElementById('qrIn').value.toUpperCase();
        // 1. ‡πÅ‡∏õ‡∏•‡∏á QR ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡∏ê‡∏≤‡∏ô 10 (n)
        let n = 0n;
        for (let i = 0; i < qr.length; i++) {
            n = n * 36n + BigInt(BASE36.indexOf(qr[i]));
        }
        
        // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤ K ‡∏à‡∏≤‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà 2 ‡∏Ç‡∏≠‡∏á QR
        const i = BASE36.indexOf(qr[1]);
        const k = getK(i);
        
        // 3. ‡∏´‡∏≤ Serial
        const serial = (n + k) % MOD_SERIAL;
        document.getElementById('resD').innerText = serial.toString().padStart(8, '0');
    }
</script>

</body>
</html>
