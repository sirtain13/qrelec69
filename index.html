<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Logic Master - Strict Validation</title>
    <style>
        :root {
            --primary: #2ecc71;
            --info: #3498db;
            --dark: #2c3e50;
            --danger: #e74c3c;
            --bg: #f4f7f6;
        }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: var(--bg); padding: 20px; display: flex; justify-content: center; }
        .container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 650px; }
        h2 { color: var(--dark); text-align: center; margin-bottom: 25px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        .section { padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #eee; transition: 0.3s; }
        .encode-bg { background-color: #f0fff4; border-color: #c6f6d5; }
        .decode-bg { background-color: #f0f7ff; border-color: #bee3f8; }
        
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #4a5568; font-size: 0.9em; }
        .input-group { display: flex; flex-direction: column; gap: 5px; margin-bottom: 10px; }
        
        input { width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1.2em; text-align: center; box-sizing: border-box; transition: 0.2s; }
        input:focus { border-color: var(--info); outline: none; box-shadow: 0 0 8px rgba(52, 152, 219, 0.2); }
        input.invalid { border-color: var(--danger); background-color: #fff5f5; }
        
        .status-msg { font-size: 0.8em; min-height: 1.2em; margin-bottom: 10px; font-weight: 500; }
        .error { color: var(--danger); }
        .success { color: var(--primary); }

        button { padding: 14px 20px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; color: white; width: 100%; transition: 0.2s; font-size: 1em; }
        button:disabled { background-color: #cbd5e0; cursor: not-allowed; opacity: 0.7; }
        button:active:not(:disabled) { transform: scale(0.98); }
        
        .btn-encode { background-color: var(--primary); }
        .btn-decode { background-color: var(--info); }
        
        .result-display { margin-top: 15px; text-align: center; font-size: 1.8em; font-weight: bold; color: var(--dark); min-height: 1.4em; border-top: 2px dashed #eee; pt: 15px; letter-spacing: 2px; }

        /* Logic Explainer */
        .logic-card { background: #2c3e50; color: #ecf0f1; padding: 25px; border-radius: 15px; margin-top: 30px; line-height: 1.7; }
        .logic-card h3 { color: var(--primary); margin-top: 0; border-bottom: 1px solid #455a64; pb: 10px; }
        .logic-card p { font-size: 0.9em; margin: 10px 0; }
        .formula { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 0.95em; color: #f1c40f; margin: 10px 0; text-align: center; }
        ul { padding-left: 20px; font-size: 0.85em; color: #bdc3c7; }
    </style>
</head>
<body>

<div class="container">
    <h2>QR Logic Master (Strict v2)</h2>

    <div class="section encode-bg">
        <label>1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™ QR (‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç Serial ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 8 ‡∏´‡∏•‡∏±‡∏Å)</label>
        <div class="input-group">
            <input type="text" id="serialIn" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç 8 ‡∏´‡∏•‡∏±‡∏Å" maxlength="8" oninput="validate(this, 8, 'sMsg', 'btnE', true)">
            <div id="sMsg" class="status-msg"></div>
        </div>
        <button id="btnE" class="btn-encode" onclick="doEncode()" disabled>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™ QR</button>
        <div id="resE" class="result-display"></div>
    </div>

    <div class="section decode-bg">
        <label>2. ‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™ Serial (‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™ QR ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 5 ‡∏´‡∏•‡∏±‡∏Å)</label>
        <div class="input-group">
            <input type="text" id="qrIn" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™ 5 ‡∏´‡∏•‡∏±‡∏Å" maxlength="5" oninput="validate(this, 5, 'qMsg', 'btnD', false)">
            <div id="qMsg" class="status-msg"></div>
        </div>
        <button id="btnD" class="btn-decode" onclick="doDecode()" disabled>‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏õ‡πá‡∏ô Serial</button>
        <div id="resD" class="result-display" style="color: var(--info);"></div>
    </div>

    <div class="logic-card">
        <h3>üí° ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (The Logic)</h3>
        <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ <b>Linear Congruential Generator (LCG)</b> ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥ Obfuscation ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡πà‡∏≤‡∏ô‡∏¢‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏ï‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏Ñ‡∏£‡∏±‡∏ö</p>
        
        <p><b>1. ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ (Encoding):</b></p>
        <ul>
            <li>‡∏ô‡∏≥‡πÄ‡∏•‡∏Ç Serial ‡∏Ñ‡∏π‡∏ì‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Ñ‡∏á‡∏ó‡∏µ‡πà (Multiplier) ‡πÅ‡∏•‡∏∞‡∏ö‡∏ß‡∏Å Offset</li>
            <li>‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Modulo ‡∏î‡πâ‡∏ß‡∏¢ $36^5$ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏´‡∏•‡∏±‡∏Å</li>
        </ul>
        <div class="formula">R = (Serial √ó 35,477,987 + 46,913,010) mod 60,466,176</div>

        <p><b>2. ‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™ (Decoding):</b></p>
        <ul>
            <li>‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Modulo ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏£‡πÑ‡∏î‡πâ ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ <b>Modular Multiplicative Inverse</b></li>
            <li>‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ Inverse ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏∑‡∏≠ <code>46,213,067</code> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏™‡∏°‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô Serial</li>
        </ul>
        <div class="formula">Serial = ((R - 46,913,010) √ó 46,213,067) mod 60,466,176</div>

        <p><b>3. ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏ê‡∏≤‡∏ô (Base36):</b></p>
        <p>‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å Map ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ <code>0-9</code> ‡πÅ‡∏•‡∏∞ <code>A-Z</code> (‡∏£‡∏ß‡∏° 36 ‡∏ï‡∏±‡∏ß) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏à‡∏≤‡∏Å 8 ‡∏´‡∏•‡∏±‡∏Å ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏û‡∏µ‡∏¢‡∏á 5 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ñ‡∏£‡∏±‡∏ö</p>
    </div>
</div>

<script>
    const M = BigInt(60466176);
    const A = BigInt(35477987);
    const B = BigInt(46913010);
    const INV = BigInt(46213067); // ‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà
    const ABC = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";

    function validate(el, len, msgId, btnId, isNum) {
        let val = el.value;
        const btn = document.getElementById(btnId);
        const msg = document.getElementById(msgId);
        
        // ‡∏Å‡∏£‡∏≠‡∏á Input
        el.value = isNum ? val.replace(/\D/g, '') : val.replace(/[^a-zA-Z0-9]/g, '').toUpperCase();
        
        const currentLen = el.value.length;
        if (currentLen === 0) {
            msg.innerText = "";
            el.classList.remove('invalid');
            btn.disabled = true;
        } else if (currentLen < len) {
            msg.innerText = `‡∏Ç‡∏≤‡∏î‡∏≠‡∏µ‡∏Å ${len - currentLen} ‡∏´‡∏•‡∏±‡∏Å`;
            msg.className = "status-msg error";
            el.classList.add('invalid');
            btn.disabled = true;
        } else {
            msg.innerText = "‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚úì";
            msg.className = "status-msg success";
            el.classList.remove('invalid');
            btn.disabled = false;
        }
    }

    function doEncode() {
        const s = BigInt(document.getElementById('serialIn').value);
        const r = (s * A + B) % M;
        let res = "", n = Number(r);
        for (let i = 4; i >= 0; i--) {
            let p = Math.pow(36, i);
            res += ABC[Math.floor(n / p)];
            n %= p;
        }
        document.getElementById('resE').innerText = res;
    }

    function doDecode() {
        const val = document.getElementById('qrIn').value;
        let r = BigInt(0);
        for (let i = 0; i < val.length; i++) r = r * 36n + BigInt(ABC.indexOf(val[i]));
        
        let step = (r - B) % M;
        if (step < 0n) step += M;
        const serial = (step * INV) % M;
        document.getElementById('resD').innerText = serial.toString().padStart(8, '0');
    }
</script>

</body>
</html>
